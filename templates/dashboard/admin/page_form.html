{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }} - SceaniCollections Admin{% endblock %}

{% block extra_head %}
<!-- CKEditor -->
<script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <div class="container mx-auto px-4 py-6 md:py-8">
        <!-- Page Header -->
        <div class="mb-6">
            <div class="flex items-center space-x-2 text-sm text-gray-500 mb-2">
                <a href="{% url 'dashboard:admin_site_content' %}" class="hover:text-scent-gold transition">Content</a>
                <i class="fas fa-chevron-right text-xs"></i>
                <a href="{% url 'dashboard:admin_pages' %}" class="hover:text-scent-gold transition">Static Pages</a>
                <i class="fas fa-chevron-right text-xs"></i>
                <span class="text-gray-700">{% if page %}Edit{% else %}Add{% endif %}</span>
            </div>
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900">{{ title }}</h1>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Sidebar -->
            <div class="lg:col-span-1 order-2 lg:order-1">
                {% include 'dashboard/admin/_sidebar.html' %}
            </div>

            <!-- Main Content -->
            <div class="lg:col-span-3 order-1 lg:order-2">
                <form method="POST" action="">
                    {% csrf_token %}

                    <!-- Basic Info -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-6">
                        <div class="p-6 border-b border-gray-100">
                            <h2 class="text-lg font-bold text-gray-900">Page Information</h2>
                        </div>
                        <div class="p-6 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Page Type <span class="text-red-500">*</span></label>
                                <select name="page" required {% if page %}disabled{% endif %}
                                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-scent-gold/20 focus:border-scent-gold {% if page %}bg-gray-100{% endif %}">
                                    <option value="">Select a page type</option>
                                    {% for choice in page_choices %}
                                    <option value="{{ choice.0 }}" {% if page.page == choice.0 %}selected{% endif %}>{{ choice.1 }}</option>
                                    {% endfor %}
                                </select>
                                {% if page %}
                                <input type="hidden" name="page" value="{{ page.page }}">
                                <p class="text-xs text-gray-500 mt-1">Page type cannot be changed after creation</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Page Title <span class="text-red-500">*</span></label>
                                <input type="text" name="title" value="{{ page.title }}" required
                                       class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-scent-gold/20 focus:border-scent-gold"
                                       placeholder="e.g., About Us, Privacy Policy">
                            </div>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-6">
                        <div class="p-6 border-b border-gray-100">
                            <h2 class="text-lg font-bold text-gray-900">Page Content</h2>
                        </div>
                        <div class="p-6">
                            <div id="editor" class="min-h-[400px]">{{ page.content|safe }}</div>
                            <input type="hidden" name="content" id="contentInput">
                        </div>
                    </div>

                    <!-- SEO -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-6">
                        <div class="p-6 border-b border-gray-100">
                            <h2 class="text-lg font-bold text-gray-900">
                                <i class="fas fa-search text-gray-400 mr-2"></i>SEO Settings
                            </h2>
                        </div>
                        <div class="p-6 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Meta Title</label>
                                <input type="text" name="meta_title" value="{{ page.meta_title }}"
                                       class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-scent-gold/20 focus:border-scent-gold"
                                       placeholder="Leave empty to use page title">
                                <p class="text-xs text-gray-500 mt-1">Recommended: 50-60 characters</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Meta Description</label>
                                <textarea name="meta_description" rows="2"
                                          class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-scent-gold/20 focus:border-scent-gold"
                                          placeholder="Brief description for search engines">{{ page.meta_description }}</textarea>
                                <p class="text-xs text-gray-500 mt-1">Recommended: 150-160 characters</p>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="flex flex-col sm:flex-row gap-3 justify-end">
                        <a href="{% url 'dashboard:admin_pages' %}" class="px-6 py-3 border border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition text-center">
                            Cancel
                        </a>
                        <button type="submit" class="px-6 py-3 bg-scent-gold text-white rounded-lg font-medium hover:bg-amber-600 transition">
                            <i class="fas fa-save mr-2"></i>{% if page %}Update Page{% else %}Create Page{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Initialize CKEditor
let editor;
ClassicEditor
    .create(document.querySelector('#editor'), {
        toolbar: ['heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList', '|', 'blockQuote', 'insertTable', '|', 'undo', 'redo'],
        heading: {
            options: [
                { model: 'paragraph', title: 'Paragraph', class: 'ck-heading_paragraph' },
                { model: 'heading1', view: 'h1', title: 'Heading 1', class: 'ck-heading_heading1' },
                { model: 'heading2', view: 'h2', title: 'Heading 2', class: 'ck-heading_heading2' },
                { model: 'heading3', view: 'h3', title: 'Heading 3', class: 'ck-heading_heading3' }
            ]
        }
    })
    .then(newEditor => {
        editor = newEditor;
    })
    .catch(error => {
        console.error('CKEditor error:', error);
    });

// Set content before form submission
document.querySelector('form').addEventListener('submit', function(e) {
    document.getElementById('contentInput').value = editor.getData();
});
</script>
{% endblock %}
