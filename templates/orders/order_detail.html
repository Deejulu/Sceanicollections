{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Order #{{ order.order_number }} - SceaniCollections{% endblock %}

{% block extra_css %}
<style>
    .order-timeline {
        position: relative;
    }
    
    .order-timeline::before {
        content: '';
        position: absolute;
        left: 15px;
        top: 24px;
        bottom: 24px;
        width: 2px;
        background: #e5e7eb;
    }
    
    .timeline-item {
        position: relative;
        padding-left: 40px;
    }
    
    .timeline-dot {
        position: absolute;
        left: 8px;
        top: 4px;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: #e5e7eb;
        border: 3px solid white;
        box-shadow: 0 0 0 2px #e5e7eb;
    }
    
    .timeline-dot.active {
        background: #D4AF37;
        box-shadow: 0 0 0 2px #D4AF37;
    }
    
    .timeline-dot.completed {
        background: #1a237e;
        box-shadow: 0 0 0 2px #1a237e;
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-gray-50 py-4 sm:py-6 md:py-8 min-h-screen" data-aos="fade-up">
    <div class="container mx-auto px-4">
        <!-- Breadcrumb -->
        <nav class="mb-4 sm:mb-6 hidden sm:block" data-aos="fade-right">
            <ol class="flex items-center text-xs sm:text-sm text-gray-500">
                <li><a href="{% url 'home' %}" class="hover:text-scent-blue transition">Home</a></li>
                <li class="mx-2">/</li>
                <li><a href="{% url 'dashboard:customer_orders' %}" class="hover:text-scent-blue transition">My Orders</a></li>
                <li class="mx-2">/</li>
                <li class="text-scent-blue">Order #{{ order.order_number }}</li>
            </ol>
        </nav>
        
        <div class="max-w-4xl mx-auto">
            <!-- Order Header -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-4 sm:mb-6">
                <div class="bg-scent-blue px-4 sm:px-6 py-3 sm:py-4">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between text-white gap-2 sm:gap-0">
                        <div>
                            <h1 class="text-lg sm:text-xl font-bold">Order #{{ order.order_number }}</h1>
                            <p class="text-gray-400 text-xs sm:text-sm">{{ order.created_at|date:"F d, Y" }} at {{ order.created_at|time:"g:i A" }}</p>
                        </div>
                        <span class="px-3 sm:px-4 py-1 sm:py-1.5 rounded-full text-[10px] sm:text-xs font-bold uppercase w-fit
                            {% if order.status == 'delivered' %}bg-green-100 text-green-700
                            {% elif order.status == 'shipped' %}bg-blue-100 text-blue-700
                            {% elif order.status == 'processing' %}bg-purple-100 text-purple-700
                            {% elif order.status == 'cancelled' %}bg-red-100 text-red-700
                            {% else %}bg-amber-100 text-amber-700{% endif %}">
                            {{ order.get_status_display }}
                        </span>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 mb-4 sm:mb-6">
                <!-- Order Items -->
                <div class="lg:col-span-2 order-2 lg:order-1">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-100">
                            <h2 class="font-semibold text-gray-900 text-sm sm:text-base">Order Items</h2>
                        </div>
                        <div class="divide-y divide-gray-100">
                            {% for item in order.items.all %}
                            <div class="p-4 sm:p-6 flex items-start gap-3 sm:gap-4">
                                {% if item.product and item.product.images.first %}
                                <img src="{{ item.product.images.first.image.url }}" alt="{{ item.product_name }}" 
                                     class="w-14 h-14 sm:w-20 sm:h-20 object-cover rounded-lg border border-gray-100">
                                {% else %}
                                <div class="w-14 h-14 sm:w-20 sm:h-20 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-wine-bottle text-gray-300 text-lg sm:text-xl"></i>
                                </div>
                                {% endif %}
                                <div class="flex-1 min-w-0">
                                    <h3 class="font-medium text-gray-900 text-sm sm:text-base truncate">{{ item.product_name }}</h3>
                                    {% if item.variant_name %}
                                    <p class="text-xs sm:text-sm text-gray-500">{{ item.variant_name }}</p>
                                    {% endif %}
                                    <p class="text-xs sm:text-sm text-gray-400">Qty: {{ item.quantity }}</p>
                                    <p class="text-xs sm:text-sm text-gray-400 sm:hidden">₦{{ item.unit_price|floatformat:0|intcomma }} each</p>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-gray-900 text-sm sm:text-base">₦{{ item.total|floatformat:0|intcomma }}</p>
                                    <p class="text-xs text-gray-400 hidden sm:block">₦{{ item.unit_price|floatformat:0|intcomma }} each</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <!-- Order Totals -->
                        <div class="px-6 py-4 bg-gray-50">
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Subtotal</span>
                                    <span>₦{{ order.subtotal|floatformat:0|intcomma }}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Shipping</span>
                                    <span>₦{{ order.shipping_fee|floatformat:0|intcomma }}</span>
                                </div>
                                {% if order.tax_amount %}
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Tax</span>
                                    <span>₦{{ order.tax_amount|floatformat:0|intcomma }}</span>
                                </div>
                                {% endif %}
                                {% if order.discount_amount %}
                                <div class="flex justify-between text-sm text-green-600">
                                    <span>Discount</span>
                                    <span>-₦{{ order.discount_amount|floatformat:0|intcomma }}</span>
                                </div>
                                {% endif %}
                                <div class="flex justify-between pt-2 border-t border-gray-200 mt-2">
                                    <span class="font-semibold text-gray-900">Total</span>
                                    <span class="text-lg font-bold text-gray-900">₦{{ order.total|floatformat:0|intcomma }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Order Info -->
                <div class="space-y-4 sm:space-y-6 order-1 lg:order-2">
                    <!-- Payment Info -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 sm:p-6">
                        <h3 class="font-semibold text-gray-900 mb-3 sm:mb-4 flex items-center text-sm sm:text-base">
                            <i class="fas fa-credit-card text-amber-500 mr-2"></i> Payment
                        </h3>
                        <div class="text-sm text-gray-600 space-y-2">
                            <div class="flex justify-between">
                                <span>Method</span>
                                <span class="font-medium text-gray-900">{{ order.get_payment_method_display }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Status</span>
                                <span class="px-2 py-0.5 rounded-full text-xs font-medium 
                                    {% if order.payment_status == 'paid' %}bg-green-50 text-green-700
                                    {% elif order.payment_status == 'pending' %}bg-amber-50 text-amber-700
                                    {% else %}bg-red-50 text-red-700{% endif %}">
                                    {{ order.get_payment_status_display }}
                                </span>
                            </div>
                            {% if order.transaction_id %}
                            <div class="flex justify-between">
                                <span>Transaction ID</span>
                                <span class="font-mono text-xs">{{ order.transaction_id }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Shipping Info -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-truck text-amber-500 mr-2"></i> Shipping
                        </h3>
                        <div class="text-sm text-gray-600 space-y-1">
                            <p class="font-medium text-gray-900">{{ order.shipping_full_name }}</p>
                            <p>{{ order.shipping_address }}</p>
                            <p>{{ order.shipping_city }}, {{ order.shipping_state }}</p>
                            {% if order.shipping_postal_code %}
                            <p>{{ order.shipping_postal_code }}</p>
                            {% endif %}
                            <p>{{ order.shipping_country.name }}</p>
                            <p class="pt-2"><i class="fas fa-phone mr-1"></i> {{ order.shipping_phone }}</p>
                        </div>
                        
                        {% if order.tracking_number %}
                        <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                            <p class="text-xs text-blue-600 font-medium mb-1">Tracking Number</p>
                            <p class="text-sm text-blue-800 font-mono">{{ order.tracking_number }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Order Timeline -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
                <h3 class="font-semibold text-gray-900 mb-6">Order History</h3>
                <div class="order-timeline" data-aos="fade-up" data-aos-delay="200">
                    <div class="timeline-item">
                        <div class="timeline-dot completed"></div>
                        <div>
                            <p class="font-medium text-gray-900 text-sm">Order Placed</p>
                            <p class="text-xs text-gray-500">{{ order.created_at|date:"M d, Y g:i A" }}</p>
                        </div>
                    </div>
                    
                    {% if order.payment_status == 'paid' %}
                    <div class="timeline-item">
                        <div class="timeline-dot completed"></div>
                        <div>
                            <p class="font-medium text-gray-900 text-sm">Payment Confirmed</p>
                            {% if order.paid_at %}
                            <p class="text-xs text-gray-500">{{ order.paid_at|date:"M d, Y g:i A" }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% elif order.payment_status == 'pending' %}
                    <div class="timeline-item">
                        <div class="timeline-dot active"></div>
                        <div>
                            <p class="font-medium text-gray-900 text-sm">Payment Pending</p>
                            <p class="text-xs text-gray-500">Awaiting payment confirmation</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if order.status == 'processing' or order.status == 'shipped' or order.status == 'delivered' %}
                    <div class="timeline-item">
                        <div class="timeline-dot {% if order.status == 'processing' %}active{% else %}completed{% endif %}"></div>
                        <div>
                            <p class="font-medium text-gray-900 text-sm">Processing</p>
                            {% if order.processing_at %}
                            <p class="text-xs text-gray-500">{{ order.processing_at|date:"M d, Y g:i A" }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if order.status == 'shipped' or order.status == 'delivered' %}
                    <div class="timeline-item">
                        <div class="timeline-dot {% if order.status == 'shipped' %}active{% else %}completed{% endif %}"></div>
                        <div>
                            <p class="font-medium text-gray-900 text-sm">Shipped</p>
                            {% if order.shipped_at %}
                            <p class="text-xs text-gray-500">{{ order.shipped_at|date:"M d, Y g:i A" }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if order.status == 'delivered' %}
                    <div class="timeline-item">
                        <div class="timeline-dot completed"></div>
                        <div>
                            <p class="font-medium text-gray-900 text-sm">Delivered</p>
                            {% if order.delivered_at %}
                            <p class="text-xs text-gray-500">{{ order.delivered_at|date:"M d, Y g:i A" }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if order.status == 'cancelled' %}
                    <div class="timeline-item">
                        <div class="timeline-dot" style="background: #ef4444; box-shadow: 0 0 0 2px #ef4444;"></div>
                        <div>
                            <p class="font-medium text-red-600 text-sm">Cancelled</p>
                            {% if order.cancelled_at %}
                            <p class="text-xs text-gray-500">{{ order.cancelled_at|date:"M d, Y g:i A" }}</p>
                            {% endif %}
                            {% if order.cancellation_reason %}
                            <p class="text-xs text-red-500 mt-1">{{ order.cancellation_reason }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Actions -->
            <div class="flex flex-wrap gap-4 justify-center">
                <a href="{% url 'dashboard:customer_orders' %}" 
                   class="inline-flex items-center px-6 py-3 bg-scent-blue text-white rounded-lg font-medium hover:bg-gray-800 transition">
                    <i class="fas fa-arrow-left mr-2 text-amber-500"></i> Back to Orders
                </a>
                {% if order.status == 'pending' and order.payment_status == 'pending' %}
                <button class="inline-flex items-center px-6 py-3 bg-red-50 text-red-600 rounded-lg font-medium hover:bg-red-100 transition">
                    <i class="fas fa-times mr-2"></i> Cancel Order
                </button>
                {% endif %}
                <a href="{% url 'store:product_list' %}" 
                   class="inline-flex items-center px-6 py-3 border border-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition">
                    <i class="fas fa-store mr-2"></i> Continue Shopping
                </a>
            </div>
            
            <!-- Support -->
            <div class="text-center mt-8 text-sm text-gray-500">
                <p>Need help with your order?</p>
                <p>Contact us at <a href="mailto:support@sceanicollections.com" class="text-scent-blue hover:underline">support@sceanicollections.com</a></p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
